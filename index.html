<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        </style>
        <title>Peta Kepadatan Penduduk Kota Bandar Lampung</title>
    </head>
    <body>
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="data/KepadatanPendudukKotaBandarLampung_2.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:9
        }).fitBounds([[-5.494963117351392,105.15756930440058],[-5.338776144766974,105.35139169206558]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var title = new L.Control({'position':'topright'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2>Peta Kepadatan Penduduk Kota Bandar Lampung</h2>';
        };
        title.addTo(map);
        var abstract = new L.Control({'position':'bottomright'});
        abstract.onAdd = function (map) {
            this._div = L.DomUtil.create('div',
            'leaflet-control abstract');
            this._div.id = 'abstract'
                this._div.setAttribute("onmouseenter", "abstract.show()");
                this._div.setAttribute("onmouseleave", "abstract.hide()");
                this.hide();
                return this._div;
            };
            abstract.hide = function () {
                this._div.classList.remove("abstractUncollapsed");
                this._div.classList.add("abstract");
                this._div.innerHTML = 'i'
            }
            abstract.show = function () {
                this._div.classList.remove("abstract");
                this._div.classList.add("abstractUncollapsed");
                this._div.innerHTML = 'Peta ini memberikan informasi mengenai luas wilayah (ha), jumlah penduduk (jiwa), kepadatan penduduk serta jumlah kelurahan setiap kecamatan di Kota Bandar lampung, Data diperoleh dari Badan Pusat Statistik Kota Bandar Lampung pada tahun 2024';
        };
        abstract.addTo(map);
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_GoogleTerrain_0');
        map.getPane('pane_GoogleTerrain_0').style.zIndex = 400;
        var layer_GoogleTerrain_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=p&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleTerrain_0',
            opacity: 1.0,
            attribution: '<a href="https://www.google.at/permissions/geoguidelines/attr-guide.html">Map data ©2015 Google</a>',
            minZoom: 9,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 20
        });
        layer_GoogleTerrain_0;
        map.createPane('pane_OSMStandard_1');
        map.getPane('pane_OSMStandard_1').style.zIndex = 401;
        var layer_OSMStandard_1 = L.tileLayer('http://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OSMStandard_1',
            opacity: 1.0,
            attribution: '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors, CC-BY-SA</a>',
            minZoom: 9,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OSMStandard_1;
        map.addLayer(layer_OSMStandard_1);
        function pop_KepadatanPendudukKotaBandarLampung_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Kecamatan</th>\
                        <td>' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Luas Wilayah (ha)</th>\
                        <td>' + (feature.properties['Join_Luas'] !== null ? autolinker.link(String(feature.properties['Join_Luas']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Jumlah Penduduk (jiwa)</th>\
                        <td>' + (feature.properties['Join_Pendu'] !== null ? autolinker.link(String(feature.properties['Join_Pendu']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Kepadatan Penduduk (km2/jiwa)</th>\
                        <td>' + (feature.properties['Join_Kepad'] !== null ? autolinker.link(String(feature.properties['Join_Kepad']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Jumlah Kelurahan</th>\
                        <td>' + (feature.properties['Join_Jumla'] !== null ? autolinker.link(String(feature.properties['Join_Jumla']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_KepadatanPendudukKotaBandarLampung_2_0(feature) {
            if (feature.properties['Join_Kepad'] >= 2091.000000 && feature.properties['Join_Kepad'] <= 5335.500000 ) {
                return {
                pane: 'pane_KepadatanPendudukKotaBandarLampung_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(248,219,219,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Join_Kepad'] >= 5335.500000 && feature.properties['Join_Kepad'] <= 7964.500000 ) {
                return {
                pane: 'pane_KepadatanPendudukKotaBandarLampung_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,136,136,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Join_Kepad'] >= 7964.500000 && feature.properties['Join_Kepad'] <= 10986.250000 ) {
                return {
                pane: 'pane_KepadatanPendudukKotaBandarLampung_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,79,79,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Join_Kepad'] >= 10986.250000 && feature.properties['Join_Kepad'] <= 17889.000000 ) {
                return {
                pane: 'pane_KepadatanPendudukKotaBandarLampung_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(157,0,0,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_KepadatanPendudukKotaBandarLampung_2');
        map.getPane('pane_KepadatanPendudukKotaBandarLampung_2').style.zIndex = 402;
        map.getPane('pane_KepadatanPendudukKotaBandarLampung_2').style['mix-blend-mode'] = 'normal';
        var layer_KepadatanPendudukKotaBandarLampung_2 = new L.geoJson(json_KepadatanPendudukKotaBandarLampung_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_KepadatanPendudukKotaBandarLampung_2',
            layerName: 'layer_KepadatanPendudukKotaBandarLampung_2',
            pane: 'pane_KepadatanPendudukKotaBandarLampung_2',
            onEachFeature: pop_KepadatanPendudukKotaBandarLampung_2,
            style: style_KepadatanPendudukKotaBandarLampung_2_0,
        });
        bounds_group.addLayer(layer_KepadatanPendudukKotaBandarLampung_2);
        map.addLayer(layer_KepadatanPendudukKotaBandarLampung_2);
        const url = {"Nominatim OSM": "https://nominatim.openstreetmap.org/search?format=geojson&addressdetails=1&",
        "France BAN": "https://api-adresse.data.gouv.fr/search/?"}
        var photonControl = L.control.photon({
            url: url["Nominatim OSM"],
            feedbackLabel: '',
            position: 'topleft',
            includePosition: true,
            initial: true,
            // resultsHandler: myHandler,
        }).addTo(map);
        photonControl._container.childNodes[0].style.borderRadius="10px"
        // Create a variable to store the geoJSON data
        var x = null;
        // Create a variable to store the marker
        var marker = null;
        // Add an event listener to the Photon control to create a marker from the returned geoJSON data
        var z = null;
        photonControl.on('selected', function(e) {
            console.log(photonControl.search.resultsContainer);
            if (x != null) {
                map.removeLayer(obj3.marker);
                map.removeLayer(x);
            }
            obj2.gcd = e.choice;
            x = L.geoJSON(obj2.gcd).addTo(map);
            var label = typeof obj2.gcd.properties.label === 'undefined' ? obj2.gcd.properties.display_name : obj2.gcd.properties.label;
            obj3.marker = L.marker(x.getLayers()[0].getLatLng()).bindPopup(label).addTo(map);
            map.setView(x.getLayers()[0].getLatLng(), 17);
            z = typeof e.choice.properties.label === 'undefined'? e.choice.properties.display_name : e.choice.properties.label;
            console.log(e);
            e.target.input.value = z;
        });
        var search = document.getElementsByClassName("leaflet-photon leaflet-control")[0];
        search.classList.add("leaflet-control-search")
        search.style.display = "flex";
        search.style.backgroundColor="rgba(255,255,255,0.5)" 

        // Create the new button element
        var button = document.createElement("div");
        button.id = "gcd-button-control";
        button.className = "gcd-gl-btn fa fa-search search-button";

        // Insert the button at the beginning of the search control
        search.insertBefore(button, search.firstChild);
        last = search.lastChild;
        last.style.display = "none";
        button.addEventListener("click", function (e) {
            if (last.style.display === "none") {
                last.style.display = "block";
            } else {
                last.style.display = "none";
            }
        });
        var overlaysTree = [
            {label: 'Kepadatan Penduduk Kota Bandar Lampung<br /><table><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukKotaBandarLampung_2_TidakPadat20915336perkm20.png" /></td><td>Tidak Padat (2,091-5,336 per km2)</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukKotaBandarLampung_2_KurangPadat53367965perkm21.png" /></td><td>Kurang Padat (5,336-7,965 per km2)</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukKotaBandarLampung_2_CukupPadat7965110986perkm22.png" /></td><td>Cukup Padat (7,9651-10,986 per km2)</td></tr><tr><td style="text-align: center;"><img src="legend/KepadatanPendudukKotaBandarLampung_2_SangatPadat1098617889perkm23.png" /></td><td>Sangat Padat (10,986-17,889 per km2)</td></tr></table>', layer: layer_KepadatanPendudukKotaBandarLampung_2},
            {label: "OSM Standard", layer: layer_OSMStandard_1},
            {label: "Google Terrain", layer: layer_GoogleTerrain_0},]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        var i = 0;
        layer_KepadatanPendudukKotaBandarLampung_2.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((exp_label_KepadatanPendudukKotaBandarLampung_2_eval_expression(context) !== null?String('<div style="color: #323232; font-size: 5pt; font-family: \'Arial Rounded MT Bold\', sans-serif;">' + exp_label_KepadatanPendudukKotaBandarLampung_2_eval_expression(context)) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_KepadatanPendudukKotaBandarLampung_2'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        resetLabels([layer_KepadatanPendudukKotaBandarLampung_2]);
        map.on("zoomend", function(){
            resetLabels([layer_KepadatanPendudukKotaBandarLampung_2]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_KepadatanPendudukKotaBandarLampung_2]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_KepadatanPendudukKotaBandarLampung_2]);
        });
        </script>
    </body>
</html>
